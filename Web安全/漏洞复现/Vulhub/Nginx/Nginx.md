## 一、介绍

### 1、简介

```php
	Nginx是一款自由、开源、高性能的HTTP服务器和反向代理服务器；同时也是一个IMAP、POP3、SMTP代理服务器；Nginx可以作为一个HTTP服务器进行网站的发布处理，另外Nginx可以作为反向代理进行负载均衡的实现。
```

### 2、端口

```
	80
```

### 3、Logo

![See the source image](https://th.bing.com/th/id/R.7dd42f963af0f04dd1b40bbeb7da93b1?rik=yewEBT9LScwTrw&pid=ImgRaw&r=0)

### 4、开发语言

```
	C
```



## 二、历史漏洞

### 1、Nginx文件名逻辑漏洞

### 2、Nginx越界读取缓存漏洞

### 3、Nginx配置错误三例

### 4、Nginx解析漏洞



## 三、利用工具



## 四、漏洞分析

### 1、Nginx文件名逻辑漏洞

```php
# CVE编号
	CVE-2013-4547
```

```php
# 版本
	Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7
```

```php
# 原理
	由于错误地解析了请求的URI，错误地获取到用户请求的文件名，导致出现权限绕过、代码执行的连带影响。正常情况下，只有.php后缀的文件才会被解析，而存在CVE-2013-4547的情况下，我们请求1.gif[0x20][0x00].php，这个URI可以匹配上正则\.php$，Nginx错误地认为请求文件是1.gif[0x20]，就造成了解析漏洞。所以，我们只需要上传一个空格结尾的文件，即可使PHP解析它。
```

### 2、Nginx越界读取缓存漏洞

```php
# CVE编号
	CVE-2017-7529
```

```php
# 版本
	Nginx 0.5.6 ~ 1.13.2
```

```php
# 原理
	Nginx在反向代理站点的时候，通常会将一些文件进行缓存，特别是静态文件。缓存的部分存储在文件中，每个缓存文件包括"文件头"+"HTTP返回包头"+"HTTP返回包体"。如果二次请求正好匹配这个缓存文件，则Nginx会直接将该文件中的"HTTP返回包体"返回给用户。
	如果我的请求中包含Range头，Nginx将会根据我指定的Start的End位置，返回指定长度的内容。而如果我们构造了两个负的位置，如（-600,-9223372036854774591），将可能读取到负位置的数据。如果这次请求又匹配到了缓存文件，则可能就可以读取到缓存文件中位于"HTTP返回包体"前的"文件头"、"HTTP返回包头"等内容。
```

### 3、Nginx配置错误三例

```php
# CVE编号
	无
```

```php
# 版本
	该漏洞与Nginx、PHP版本无关，属于用户配置不当造成的问题
```

```php
# 原理1：CRLF注入
	Nginx会将传入的URI进行编码，导致传入%0a%0b即可引入换行符，造成CRLF注入漏洞。
```

```php
# 原理2：目录穿越
	Nginx在配置别名的时候，如果忘记加/，将造成一个目录穿越漏洞。
```

```php
# 原理3：add_header被覆盖
	Nginx配置文件子块（server、location、if）中的add_header，将会覆盖父块中的add_header添加的HTTP头，造成一些安全隐患。
```

### 4、Nginx解析漏洞

```php
# CVE编号
	无
```

```php
# 版本
	该漏洞与Nginx、PHP版本无关，属于用户配置不当造成的解析漏洞。
```

```php
# 原理
	由于Nginx.conf的配置中把'.php'结尾的文件交给fastcgi处理，因此可以构造http://xx/test.png/.php，对于任意文件名，在后面加上/*.php，该文件就会以php格式进行解析。
```

